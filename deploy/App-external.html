<!DOCTYPE html>
<html>
<head>
    <title>ChangeLogAnnotation</title>

    <script type="text/javascript" src="https://us1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(view){"use strict";if(view.URL=view.URL||view.webkitURL,view.Blob&&view.URL)try{return new Blob,void 0}catch(e){}var BlobBuilder=view.BlobBuilder||view.WebKitBlobBuilder||view.MozBlobBuilder||function(view){var get_class=function(object){return Object.prototype.toString.call(object).match(/^\[object\s(.*)\]$/)[1]},FakeBlobBuilder=function BlobBuilder(){this.data=[]},FakeBlob=function Blob(data,type,encoding){this.data=data,this.size=data.length,this.type=type,this.encoding=encoding},FBB_proto=FakeBlobBuilder.prototype,FB_proto=FakeBlob.prototype,FileReaderSync=view.FileReaderSync,FileException=function(type){this.code=this[this.name=type]},file_ex_codes="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),file_ex_code=file_ex_codes.length,real_URL=view.URL||view.webkitURL||view,real_create_object_URL=real_URL.createObjectURL,real_revoke_object_URL=real_URL.revokeObjectURL,URL=real_URL,btoa=view.btoa,atob=view.atob,ArrayBuffer=view.ArrayBuffer,Uint8Array=view.Uint8Array;for(FakeBlob.fake=FB_proto.fake=!0;file_ex_code--;)FileException.prototype[file_ex_codes[file_ex_code]]=file_ex_code+1;return real_URL.createObjectURL||(URL=view.URL={}),URL.createObjectURL=function(blob){var type=blob.type,data_URI_header;return null===type&&(type="application/octet-stream"),blob instanceof FakeBlob?(data_URI_header="data:"+type,"base64"===blob.encoding?data_URI_header+";base64,"+blob.data:"URI"===blob.encoding?data_URI_header+","+decodeURIComponent(blob.data):btoa?data_URI_header+";base64,"+btoa(blob.data):data_URI_header+","+encodeURIComponent(blob.data)):real_create_object_URL?real_create_object_URL.call(real_URL,blob):void 0},URL.revokeObjectURL=function(object_URL){"data:"!==object_URL.substring(0,5)&&real_revoke_object_URL&&real_revoke_object_URL.call(real_URL,object_URL)},FBB_proto.append=function(data){var bb=this.data;if(Uint8Array&&(data instanceof ArrayBuffer||data instanceof Uint8Array)){for(var str="",buf=new Uint8Array(data),i=0,buf_len=buf.length;buf_len>i;i++)str+=String.fromCharCode(buf[i]);bb.push(str)}else if("Blob"===get_class(data)||"File"===get_class(data)){if(!FileReaderSync)throw new FileException("NOT_READABLE_ERR");var fr=new FileReaderSync;bb.push(fr.readAsBinaryString(data))}else data instanceof FakeBlob?"base64"===data.encoding&&atob?bb.push(atob(data.data)):"URI"===data.encoding?bb.push(decodeURIComponent(data.data)):"raw"===data.encoding&&bb.push(data.data):("string"!=typeof data&&(data+=""),bb.push(unescape(encodeURIComponent(data))))},FBB_proto.getBlob=function(type){return arguments.length||(type=null),new FakeBlob(this.data.join(""),type,"raw")},FBB_proto.toString=function(){return"[object BlobBuilder]"},FB_proto.slice=function(start,end,type){var args=arguments.length;return 3>args&&(type=null),new FakeBlob(this.data.slice(start,args>1?end:this.data.length),type,this.encoding)},FB_proto.toString=function(){return"[object Blob]"},FB_proto.close=function(){this.size=0,delete this.data},FakeBlobBuilder}(view);view.Blob=function Blob(blobParts,options){var type=options?options.type||"":"",builder=new BlobBuilder;if(blobParts)for(var i=0,len=blobParts.length;len>i;i++)builder.append(blobParts[i]);return builder.getBlob(type)}})("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);
                var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(view){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link=!view.externalHost&&"download"in save_link,click=function(node){var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",!0,!1,view,0,0,0,0,0,!1,!1,!1,!1,0,null),node.dispatchEvent(event)},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,deletion_queue=[],process_deletion_queue=function(){for(var i=deletion_queue.length;i--;){var file=deletion_queue[i];"string"==typeof file?get_URL().revokeObjectURL(file):file.remove()}deletion_queue.length=0},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);for(var i=event_types.length;i--;){var listener=filesaver["on"+event_types[i]];if("function"==typeof listener)try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}},FileSaver=function(blob,name){var filesaver=this,type=blob.type,blob_changed=!1,object_url,target_view,get_object_url=function(){var object_url=get_URL().createObjectURL(blob);return deletion_queue.push(object_url),object_url},dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){(blob_changed||!object_url)&&(object_url=get_object_url(blob)),target_view?target_view.location.href=object_url:window.open(object_url,"_blank"),filesaver.readyState=filesaver.DONE,dispatch_all()},abortable=function(func){return function(){return filesaver.readyState!==filesaver.DONE?func.apply(this,arguments):void 0}},create_if_not_found={create:!0,exclusive:!1},slice;return filesaver.readyState=filesaver.INIT,name||(name="download"),can_use_save_link?(object_url=get_object_url(blob),save_link.href=object_url,save_link.download=name,click(save_link),filesaver.readyState=filesaver.DONE,dispatch_all(),void 0):(view.chrome&&type&&type!==force_saveable_type&&(slice=blob.slice||blob.webkitSlice,blob=slice.call(blob,0,blob.size,force_saveable_type),blob_changed=!0),webkit_req_fs&&"download"!==name&&(name+=".download"),(type===force_saveable_type||webkit_req_fs)&&(target_view=view),req_fs?(fs_min_size+=blob.size,req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL(),deletion_queue.push(file),filesaver.readyState=filesaver.DONE,dispatch(filesaver,"writeend",event)},writer.onerror=function(){var error=writer.error;error.code!==error.ABORT_ERR&&fs_error()},"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]}),writer.write(blob),filesaver.abort=function(){writer.abort(),filesaver.readyState=filesaver.DONE},filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:!1},abortable(function(file){file.remove(),save()}),abortable(function(ex){ex.code===ex.NOT_FOUND_ERR?save():fs_error()}))}),fs_error)}),fs_error),void 0):(fs_error(),void 0))},FS_proto=FileSaver.prototype,saveAs=function(blob,name){return new FileSaver(blob,name)};return FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE,dispatch(filesaver,"abort")},FS_proto.readyState=FS_proto.INIT=0,FS_proto.WRITING=1,FS_proto.DONE=2,FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null,view.addEventListener("unload",process_deletion_queue,!1),saveAs.unload=function(){process_deletion_queue(),view.removeEventListener("unload",process_deletion_queue,!1)},saveAs}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});
                Ext.define("Rally.technicalservices.FileUtilities",{singleton:!0,saveCSVToFile:function(csv,file_name,type_object){void 0===type_object&&(type_object={type:"text/csv;charset=utf-8"});var blob=new Blob([csv],type_object);saveAs(blob,file_name)},saveTextAsFile:function(textToWrite,fileName){var textFileAsBlob=new Blob([textToWrite],{type:"text/plain"}),fileNameToSaveAs=fileName,downloadLink=document.createElement("a");downloadLink.download=fileNameToSaveAs,downloadLink.innerHTML="Download File",null!==window.webkitURL?downloadLink.href=window.webkitURL.createObjectURL(textFileAsBlob):(downloadLink.href=window.URL.createObjectURL(textFileAsBlob),downloadLink.onclick=destroyClickedElement,downloadLink.style.display="none",document.body.appendChild(downloadLink)),downloadLink.click()},destroyClickedElement:function(event){document.body.removeChild(event.target)},convertDataArrayToCSVText:function(data_array,requestedFieldHash){var text="";return Ext.each(Object.keys(requestedFieldHash),function(key){text+=requestedFieldHash[key]+","}),text=text.replace(/,$/,"\n"),Ext.each(data_array,function(d){Ext.each(Object.keys(requestedFieldHash),function(key){text+=d[key]?"object"==typeof d[key]?d[key].FormattedID?Ext.String.format('"{0}",',d[key].FormattedID):d[key].Name?Ext.String.format('"{0}",',d[key].Name):isNaN(Date.parse(d[key]))?Ext.String.format('"{0}",',""+d[key]):Ext.String.format('"{0}",',Rally.util.DateTime.formatWithDefaultDateTime(d[key])):Ext.String.format('"{0}",',d[key]):","},this),text=text.replace(/,$/,"\n")},this),text},_getCSVFromWsapiBackedGrid:function(grid){for(var deferred=Ext.create("Deft.Deferred"),store=Ext.create("Rally.data.wsapi.Store",{fetch:grid.getStore().config.fetch,filters:grid.getStore().config.filters,model:grid.getStore().config.model,pageSize:200}),columns=grid.columns,headers=this._getHeadersFromGrid(grid),column_names=this._getColumnNamesFromGrid(grid),record_count=grid.getStore().getTotalCount(),page_size=grid.getStore().pageSize,pages=Math.ceil(record_count/page_size),promises=[],page=1;pages>=page;page++)promises.push(this._loadStorePage(grid,store,columns,page,pages));return Deft.Promise.all(promises).then({success:function(csvs){var csv=[];csv.push('"'+headers.join('","')+'"'),_.each(csvs,function(c){_.each(c,function(line){csv.push(line)})}),csv=csv.join("\r\n"),deferred.resolve(csv),Rally.getApp().setLoading(!1)}}),deferred.promise},_getCSVFromCustomBackedGrid:function(grid){var deferred=Ext.create("Deft.Deferred"),me=this;Rally.getApp().setLoading("Assembling data for export...");var headers=this._getHeadersFromGrid(grid),store=Ext.clone(grid.getStore()),columns=grid.columns,column_names=this._getColumnNamesFromGrid(grid),record_count=grid.getStore().getTotalCount(),original_page_size=grid.getStore().pageSize,page_size=200,number_of_pages=Math.ceil(record_count/page_size);store.pageSize=page_size;for(var pages=[],promises=[],page=1;number_of_pages>=page;page++)pages.push(page);return Ext.Array.each(pages,function(page){promises.push(function(){return me._loadStorePage(grid,store,columns,page,pages.length)})}),Deft.Chain.sequence(promises).then({success:function(csvs){store.pageSize=original_page_size,store.loadPage(1);var csv=[];csv.push('"'+headers.join('","')+'"'),_.each(csvs,function(c){_.each(c,function(line){csv.push(line)})}),csv=csv.join("\r\n"),deferred.resolve(csv),Rally.getApp().setLoading(!1)}}),deferred.promise},_getHeadersFromGrid:function(grid){var headers=[],columns=grid.columns;return Ext.Array.each(columns,function(column){(column.dataIndex||column.renderer)&&(column.csvText?headers.push(column.csvText):column.text&&headers.push(column.text))}),headers},_getColumnNamesFromGrid:function(grid){var names=[],columns=grid.columns;return Ext.Array.each(columns,function(column){(column.dataIndex||column.renderer)&&names.push(column.dataIndex)}),names},getCSVFromGrid:function(app,grid){return"Rally.data.custom.Store"!=Ext.getClassName(grid.getStore())?this._getCSVFromWsapiBackedGrid(grid):this._getCSVFromCustomBackedGrid(grid)},_loadStorePage:function(grid,store,columns,page,total_pages){var deferred=Ext.create("Deft.Deferred");return store.loadPage(page,{callback:function(records){Rally.getApp().setLoading(Ext.String.format("Page {0} of {1}",page,total_pages));for(var csv=[],i=0;records.length>i;i++){var record=records[i];csv.push(this._getCSVFromRecord(record,grid,store))}deferred.resolve(csv)},scope:this}),deferred.promise},_getCSVFromRecord:function(record,grid,store){var mock_meta_data={align:"right",classes:[],cellIndex:9,column:null,columnIndex:9,innerCls:void 0,recordIndex:5,rowIndex:5,style:"",tdAttr:"",tdCls:"x-grid-cell x-grid-td x-grid-cell-headerId-gridcolumn-1029 x-grid-cell-last x-unselectable",unselectableAttr:"unselectable='on'"},node_values=[],columns=grid.columns;return Ext.Array.each(columns,function(column){if(display_value=null,"rallyrowactioncolumn"!=column.xtype)if(column.dataIndex){var column_name=column.dataIndex;display_value=record.get(column_name),!column._csvIgnoreRender&&column.renderer&&(display_value=column.exportRenderer?column.exportRenderer(display_value,mock_meta_data,record,0,0,store,grid.getView()):column.renderer(display_value,mock_meta_data,record,0,0,store,grid.getView())),node_values.push(display_value)}else!column._csvIgnoreRender&&column.renderer&&(display_value=column.exportRenderer?column.exportRenderer(display_value,mock_meta_data,record,record,0,0,store,grid.getView()):column.renderer(display_value,mock_meta_data,record,record,0,0,store,grid.getView()),node_values.push(display_value))},this),'"'+node_values.join('","')+'"'}});
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",items:[{xtype:"container",region:"north",itemId:"selectorsContainer",layout:{type:"hbox"},padding:5},{xtype:"container",region:"center",layout:"fit",itemId:"gridContainer"}],layout:{type:"border"},_lookBackDataFetchLimit:400,_preferencesPrefix:"com.swisscom.tv20.changelog_",_dateFormat:"m/d/Y g:i A",_onlyShowValuesNewerThan:"2015-09-28",launch:function(){this._fetchAllDataAndDisplayGrid()},_fetchAllDataAndDisplayGrid:function(){var me=this;this.setLoading("Loading Data"),Deft.Chain.sequence([this._fetchLookbackData,this._fetchPreferenceModel,this._fetchUsers,this._fetchPreferencesData],this).then({success:function(data){var lookbackData=data[0];this._preferenceModel=data[1],this._usersData=data[2];var preferencesData=data[3],displayData=this._prepareDisplayData(lookbackData);this._displayDataStore=Ext.create("Rally.data.custom.Store",{data:displayData,listeners:{scope:this,load:function(store,records){this._mergePreferencesToDisplayData(records,preferencesData);var container=this.down("#selectorsContainer");container.removeAll(),this._createViewDropdown(container),this._createExportButton(container)}}})},scope:this}).always(function(){me.setLoading(!1)})},_fetchLookbackData:function(){var deferred=Ext.create("Deft.Deferred"),typeFilter=Ext.create("Rally.data.lookback.QueryFilter",{property:"_TypeHierarchy",operator:"in",value:["PortfolioItem/Feature"]}),dateFilter=Ext.create("Rally.data.lookback.QueryFilter",{property:"_ValidFrom",operator:">",value:this._onlyShowValuesNewerThan}),changeFilter=Rally.data.lookback.QueryFilter.or([{property:"_PreviousValues.Name",operator:"exists",value:!0},{property:"_PreviousValues.c_MustLaunchTarget",operator:"exists",value:!0},{property:"_PreviousValues.Release",operator:"exists",value:!0},{property:"_PreviousValues",operator:"exists",value:!1}]);return Ext.create("Rally.data.lookback.SnapshotStore",{listeners:{load:function(store,data,success){Ext.Array.each(data,function(datum){console.log("--",datum.get("ObjectID"),datum.get("FormattedID"),datum)}),deferred.resolve(data)}},removeUnauthorizedSnapshots:!0,autoLoad:!0,fetch:["FormattedID","Name","_PreviousValues","_User","c_MustLaunchTarget","Release","Project","_PreviousValues.Release","_PreviousValues.Project","_PreviousValues.c_MustLaunchTarget","_PreviousValues.Name"],hydrate:["Release","Project","_PreviousValues.Release","_PreviousValues.Project"],filters:typeFilter.and(dateFilter).and(changeFilter),sorters:[{property:"_ValidFrom",direction:"DESC"}],pageSize:this._lookBackDataFetchLimit}),deferred.promise},_fetchPreferencesData:function(){var deferred=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:"Preference",autoLoad:!0,fetch:["Name","Value"],listeners:{load:function(store,data,success){var preferenceHash={};Ext.Array.each(data,function(preference){preferenceHash[preference.get("Name")]=preference}),deferred.resolve(preferenceHash)}},filters:[{property:"Name",operator:"contains",value:this._preferencesPrefix}],limit:1/0}),deferred.promise},_fetchPreferenceModel:function(){var deferred=Ext.create("Deft.Deferred");return Rally.data.ModelFactory.getModel({type:"Preference",success:function(model){deferred.resolve(model)}}),deferred.promise},_fetchUsers:function(){var deferred=Ext.create("Deft.Deferred");return Ext.create("Rally.data.wsapi.Store",{model:"User",autoLoad:!0,fetch:["ObjectID"],listeners:{load:function(store,data,success){var usersHash={};Ext.Array.each(data,function(user){usersHash[user.get("ObjectID")]=user}),deferred.resolve(usersHash)}},limit:1/0}),deferred.promise},_prepareDisplayData:function(lookbackData){var displayData=[];return Ext.Array.each(lookbackData,function(snapshot){displayData.push({Preference:{},FeatureOID:snapshot.get("ObjectID"),ProjectOID:snapshot.get("Project"),ValidFrom:snapshot.get("_ValidFrom"),FormattedID:snapshot.get("FormattedID"),FeatureName:snapshot.get("Name"),User:snapshot.get("_User"),RallyChangeReason:this._extractRallyChangeReason(snapshot),ChangeDescription:null,Ignore:!1,ReviewedByCoreTeam:!1,ReviewedByProductCouncil:!1})},this),displayData},_mergePreferencesToDisplayData:function(records,preferencesHash){var displayData=[];Ext.Array.each(records,function(record){var preferenceName=this._preferencesPrefix+record.get("FeatureOID")+"_"+record.get("ValidFrom"),preference=preferencesHash[preferenceName];preference||(preference=Ext.create(this._preferenceModel,{Name:preferenceName,Project:this.getContext().getProject(),Value:"{}"}));var preferenceValues=Ext.JSON.decode(preference.get("Value"));record.set("Preference",preference),record.set("ChangeDescription",preferenceValues.ChangeDescription),record.set("Ignore",preferenceValues.Ignore||!1),record.set("ReviewedByCoreTeam",preferenceValues.ReviewedByCoreTeam||!1),record.set("ReviewedByProductCouncil",preferenceValues.ReviewedByProductCouncil||!1)},this)},_extractRallyChangeReason:function(snapshot){var reason=[];return null===snapshot.get("_PreviousValues").Name&&reason.push("Feature CREATED"),Ext.isEmpty(snapshot.get("_PreviousValues"))&&(snapshot.get("_ValidFrom")==snapshot.get("_ValidTo")?reason.push("Feature DELETED"):reason.push("Feature RESTORED")),Ext.isEmpty(snapshot.get("_PreviousValues").Name)||reason.push("NAME changed from ["+snapshot.get("_PreviousValues").Name+"]"),void 0!==snapshot.get("_PreviousValues").Release&&reason.push(this._rallyChangeReasonStringHelper(snapshot.get("_PreviousValues.Release"),snapshot.get("Release"),"RELEASE","Name")),void 0!==snapshot.get("_PreviousValues").Project&&reason.push(this._rallyChangeReasonStringHelper(snapshot.get("_PreviousValues").Project,snapshot.get("Project"),"PROJECT","Name")),void 0!==snapshot.get("_PreviousValues").c_MustLaunchTarget&&reason.push(this._rallyChangeReasonStringHelper(snapshot.get("_PreviousValues").c_MustLaunchTarget,snapshot.get("c_MustLaunchTarget"),"MUST LAUNCH TARGET")),reason.join(", ")},_rallyChangeReasonStringHelper:function(previousValue,newValue,fieldDisplayName,fieldName){var result;return Ext.isObject(previousValue)&&(previousValue=previousValue[fieldName]),Ext.isObject(newValue)&&(newValue=newValue[fieldName]),Ext.isEmpty(previousValue)?Ext.isEmpty(newValue)||(result=fieldDisplayName+" added ["+newValue+"]"):result=Ext.isEmpty(newValue)?fieldDisplayName+" of ["+previousValue+"] removed":fieldDisplayName+" changed from ["+previousValue+"] to ["+newValue+"]",result},_createExportButton:function(container){container.add({xtype:"container",flex:1}),container.add({xtype:"rallybutton",itemId:"exportButton",text:'<span class="icon-export"> </span>',disabled:this.down("combo")&&"All Items"==this.down("combo").getValue,listeners:{scope:this,click:function(){this._export()}}})},_createViewDropdown:function(container){var views=Ext.create("Ext.data.Store",{fields:["name"],data:[{name:"All Items"},{name:"To Be Reviewed Core Team"},{name:"To Be Reviewed Product Council"}]});container.add({xtype:"combo",fieldLabel:"Filter:",labelWidth:35,store:views,queryMode:"local",displayField:"name",valueField:"name",stateful:!0,stateEvents:["change"],stateId:this._preferencesPrefix+"filter",listeners:{change:function(combobox,newValue,oldValue,eOpts){var button=this.down("rallybutton");button&&(button.setDisabled(!0),"All Items"==newValue&&button.setDisabled(!1)),this._createGrid(newValue)},scope:this}})},_createGrid:function(view){var gridContainer=this.down("#gridContainer"),myColumnCfg=[],self=this,validFromRow={dataIndex:"ValidFrom",text:"When",renderer:Ext.util.Format.dateRenderer(this._dateFormat)},userRow={dataIndex:"User",text:"Who",renderer:function(value){var user=self._usersData[value];return user?self._usersData[value].get("_refObjectName"):"(Deleted User)"}},formattedIdRow={dataIndex:"FormattedID",text:"Feature ID",_csvIgnoreRender:!0,renderer:function(value,metaData,record){return'<a href="https://rally1.rallydev.com/#/search?keywords='+value+'" target="_blank">'+value+"</a>"}},featureNameRow={dataIndex:"FeatureName",text:"Feature Name"},rallyChangeReasonRow={dataIndex:"RallyChangeReason",text:"Rally Change Reason",editor:{xtype:"rallytextfield",readOnly:!0}},changeDescriptionRow={dataIndex:"ChangeDescription",text:"Change Description",editor:"rallytextfield",flex:1},reviewByCoreTeamRow={dataIndex:"ReviewedByCoreTeam",text:"Reviewed Core Team",editor:"rallycheckboxfield",renderer:function(value){return value?"Yes":"No"}},reviewByProductCouncilRow={dataIndex:"ReviewedByProductCouncil",text:"Reviewed Product Council",editor:"rallycheckboxfield",renderer:function(value){return value?"Yes":"No"}},ignoreRow={xtype:"actioncolumn",width:50,renderer:function(value,metadata,record,rowIndex,colIndex,store,view){return this.items&&this.items.length>0&&(this.items[0].icon=record.get("Ignore")?"https://rally1.rallydev.com/slm/images/icon_find.gif":"https://rally1.rallydev.com/slm/images/icon_cancel.gif"),""},exportRenderer:function(value,metadata,record){return record.get("Ignore")},items:[{icon:"https://rally1.rallydev.com/slm/images/icon_cancel.gif",tooltip:"Ignore Change",isDisabled:function(view,rowIndex,colIndex,item,record){return record.get("Ignored")},handler:function(grid,rowIndex,colIndex){var record=grid.getStore().getAt(rowIndex),newValue=!record.get("Ignore");record.set("Ignore",newValue),this._updateAndSaveNewPreferenceValue(record.get("Preference"),"Ignore",newValue)},scope:this}]},showNotIgnoredRowsFilter={property:"Ignore",operator:"!=",value:!0},hasChangeDescription={property:"ChangeDescription",operator:"!=",value:null};this._displayDataStore.clearFilter(),"All Items"==view?myColumnCfg=[validFromRow,userRow,formattedIdRow,featureNameRow,rallyChangeReasonRow,changeDescriptionRow,reviewByCoreTeamRow,reviewByProductCouncilRow,ignoreRow]:"To Be Reviewed Core Team"==view?(myColumnCfg=[validFromRow,userRow,formattedIdRow,featureNameRow,changeDescriptionRow,reviewByCoreTeamRow],this._displayDataStore.addFilter(showNotIgnoredRowsFilter),this._displayDataStore.addFilter(hasChangeDescription),this._displayDataStore.addFilter({property:"ReviewedByCoreTeam",operator:"!=",value:!0})):"To Be Reviewed Product Council"==view&&(myColumnCfg=[validFromRow,userRow,formattedIdRow,featureNameRow,changeDescriptionRow,reviewByProductCouncilRow],this._displayDataStore.addFilter(showNotIgnoredRowsFilter),this._displayDataStore.addFilter(hasChangeDescription),this._displayDataStore.addFilter({property:"ReviewedByProductCouncil",operator:"!=",value:!0})),gridContainer.removeAll(),gridContainer.add({xtype:"rallygrid",viewConfig:{getRowClass:function(record){return record&&record.get("Ignore")===!0?"disabled-row":void 0}},store:this._displayDataStore,columnCfgs:myColumnCfg,sortableColumns:!1,listeners:{edit:function(editor,evt){evt.value!=evt.originalValue&&Ext.Array.contains(["ChangeDescription","ReviewedByCoreTeam","ReviewedByProductCouncil","Ignore"],evt.field)&&this._updateAndSaveNewPreferenceValue(evt.record.get("Preference"),evt.field,evt.record.get(evt.field))},scope:this}})},_updateAndSaveNewPreferenceValue:function(preference,field,newValue){var preferenceValues=Ext.JSON.decode(preference.get("Value"));preferenceValues[field]=newValue,preference.set("Value",Ext.JSON.encode(preferenceValues)),preference.save({callback:function(result,operation){operation.wasSuccessful()||Ext.Msg.alert("Problem","Saving failed")}})},_export:function(){var grid=this.down("rallygrid"),me=this;if(grid){500>this._lookBackDataFetchLimit&&Ext.Msg.alert("Warning","The number of records exported is limited to "+this._lookBackDataFetchLimit+". If you need a complete data dump, please increase the value for _lookBackDataFetchLimit in the app's source code.");var filename=Ext.String.format("changelog.csv");this.setLoading("Generating CSV"),Deft.Chain.sequence([function(){return Rally.technicalservices.FileUtilities.getCSVFromGrid(this,grid)}]).then({scope:this,success:function(csv){csv&&csv.length>0?Rally.technicalservices.FileUtilities.saveCSVToFile(csv,filename):Rally.ui.notify.Notifier.showWarning({message:"No data to export"})}}).always(function(){me.setLoading(!1)})}}});

            Rally.launchApp('CustomApp', {
                name:"ChangeLogAnnotation",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .rally-grid .disabled-row .x-grid-cell{color:lightgray}
    </style>
</head>
<body>
</body>
</html>
